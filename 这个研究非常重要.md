# Language models generalize beyond natural proteins
## 摘要
从序列中学习蛋白质的设计模式
跨进化学习蛋白质的设计模式可能对生成性蛋白质设计有前景。然而，目前尚不清楚仅基于自然蛋白质序列训练的语言模型是否能够超越对现有蛋白质家族的记忆。在这里，我们展示了语言模型不仅能泛化到自然蛋白质之外，还能生成全新的蛋白质。我们关注两个蛋白质设计任务：固定骨架设计，其中结构是指定的，以及不受约束的生成，其中结构由模型采样。值得注意的是，尽管这些模型只训练了序列，我们发现它们能够设计结构。共有228个生成的蛋白质在实验中进行了评估，以高成功率（152/228或67%）产生了可溶性和单体物种，通过大小排阻色谱法检测。在152个实验成功的设计中，有35个与已知自然蛋白质没有显著的序列匹配。在剩余的117个中，与最近序列匹配的序列同一性中位数为27%，6个设计低于20%，3个设计低至18%。对于固定骨架设计，语言模型为每个经过实验评估的人工创建的固定骨架目标生成成功的设计。对于不受约束的生成，采样的蛋白质涵盖了多样的拓扑结构和次级结构组成，并具有高实验成功率（71/129或55%）。这些设计反映了连接序列和结构的深层模式，包括在相关自然结构中出现的基序，以及在已知蛋白质家族的类似结构环境中未观察到的基序。这些结果表明，虽然语言模型仅在序列上进行训练，但它们学习了一种深层语法，使得能够设计蛋白质结构，超越自然蛋白质。  
## 引言
用于生物学的生成性人工智能有潜力开启超越自然蛋白质的蛋白质设计空间。由于氨基酸序列是蛋白质的基本编码，学习用语言模型读写这些编码可能具有前景。语言模型在近期人工智能的进展中发挥了核心作用（1），包括在复杂推理、数学问题解决、图像生成和自然语言生成（2-4）等领域的发展。性能与用于训练模型的计算能力、数据量和参数数量之间的关联由缩放定律描述（5），并且随着规模的增加，观察到更高级别能力的出现（6）。在生物学领域，最近关于蛋白质的进化规模语言模型的研究表明，从训练蛋白质序列中获得对生物内在属性的深入知识（7）。模型内部形成了关于蛋白质折叠的三维结构的信息，甚至扩展到原子级分辨率结构（8）。这些信息仅通过序列训练而获得。同时，结果显示，由序列训练得出的结构信息取决于可用的进化信息，随着训练数据中相关蛋白质数量的变化而变化（8, 9）。在各个领域中，语言模型能在多大程度上推广到其训练数据之外，这仍是一个开放性问题。在生物学中，尚不清楚语言模型是否可以用来探索超出自然蛋白质的设计空间。  

在这里，我们展示了语言模型能够推广到自然蛋白质之外，生成在序列和结构上不同于自然蛋白质的新蛋白质。我们通过实验验证了多种多样的拓扑和序列的大量设计。我们发现，尽管语言模型仅在蛋白质序列上进行训练，它们能够设计蛋白质结构，包括与自然蛋白质不同的人工设计的新蛋白质的结构。在以新蛋白质结构的骨架为目标的情况下，语言模型生成被预测会折叠到指定结构的序列。当序列和结构都是自由的时候，语言模型产生的设计覆盖了广泛的折叠拓扑和次级结构组成，创造了与自然序列分布重叠并且超越它的蛋白质。在抽样蛋白质空间中，设计在实验上成功，包括许多与自然蛋白质序列相距较远的设计。该模型生成连接序列与结构设计的基序，并能将它们应用于新的序列和结构环境中，包括复杂的氢键网络等在序列或结构上类似的已知蛋白质中未发现的基序。整体实验成功率很高，共有228个经过实验评估的蛋白质中有152个（67%）产生了可溶解和单体的物种，通过大小排阻色谱法（SEC）检测。高成功率也扩展到与自然蛋白质距离较远的蛋白质，其中49个经过实验评估的蛋白质中有31个（63%）成功。  

### 蛋白质序列的深层语法

我们假设蛋白质序列中存在一种深层的潜在语法，使得语言模型能够进行泛化。为了超越自然蛋白质，语言模型将需要访问扩展到自然蛋白质空间之外的设计模式。传统上，这种形式的泛化是由一个基于物理的能量函数启用的，该函数能够捕捉到天然折叠状态（10）。最近，基于结构的深度学习方法被提出作为通过反转结构预测（11，12）或基于主链结构的条件（13-15）来解决这个问题的新方法。通过在训练期间显式地对结构进行建模，新的深度学习方法可能会捕捉到类似于物理能量的东西（16）。语言模型在这个问题上的成功表明，序列中的深层模式可能提供一条替代的泛化路径，这条路径独立于对潜在物理模型的显式建模。  

从序列进行进化推断的经典视角是，关于蛋白质的属性信息通过保守性和共进化编码到进化相关蛋白质的序列模式中。这一观点来自于蛋白质家族的统计数据反映了对序列演化的限制，包括生物结构和功能（17，18）。这一洞察为从蛋白质家族的序列中推断结构和功能奠定了基础（19），并且最近也通过生成模型成功地用于从现有蛋白质家族生成新的例子（20-22）。到目前为止，基于序列的蛋白质设计模型的实验验证仅限于自然蛋白质家族。  

访问远离自然发生的蛋白质家族的新蛋白质设计空间是一个根本上更具挑战性的问题。根据定义，这个问题不能通过生成自然发生的蛋白质家族的新样本来解决。要用基于序列的模型解决这个问题，将需要学习超越个别蛋白质家族的序列模式。进化尺度的语言模型通过在演化过程中对多样化的序列进行训练，超越了经典的蛋白质家族模型，这意味着它们有潜力学习所有蛋白质的深层模式，包括那些没有实验结构的情况。有证据表明，序列中的局部模式超越了个别蛋白质家族，在序列中呈局部（23）以及在三维空间中呈局部的基序形式（24）。然而，序列与结构之间的映射并非一一对应（25），设计序列以达到良好折叠的天然状态需要解决一个指数级的大组合问题，以选择一组局部序列模式，这些模式非局部地相互作用以指定一个连贯的结构（26）。要设计蛋白质结构，语言模型将必须发展对序列如何决定结构的隐含理解，包括连接结构设计与序列的局部规则，以及决定序列是否连贯并将折叠成天然状态的全局规则。  

### 使用语言模型的生成性蛋白质设计
我们评估语言模型的生成能力，专注于超越自然蛋白质的泛化。由演化采样的已知蛋白质序列仅代表了庞大的可能蛋白质数量的一小部分（图1A）。要在演化探索过的蛋白质空间之外泛化，将需要访问适用于该空间之外的蛋白质设计的深层模式。我们关注两个生成性蛋白质设计任务。第一个是固定主链设计，其目标是生成一个折叠到目标结构的序列。这个任务评估了语言模型的能力，该模型仅在序列上进行训练，以设计蛋白质结构。第二个任务是自由生成，其中结构不受约束并允许随序列变化。这使得能够描述模型在不同序列和结构模式上的完整生成能力，以理解模型可访问的蛋白质空间。

使用一组新设计的人工蛋白质测试集来评估超越自然蛋白质结构的泛化。测试集包括从蛋白质数据银行（PDB）（27）选择的多样化的结构验证的人工蛋白质结构（N = 39），涵盖一系列长度（67≤L≤184）和拓扑（图S1和附录A.1）。重要的是，这些新蛋白质在结构上与属于自然折叠的蛋白质有意义的差异，包括关于理想性、精确重复和元素的对称性。由于语言模型没有在蛋白质结构上进行训练，为这些主链生成设计测试了模型泛化到与其训练序列不同的自然蛋白质结构的能力。 

语言模型ESM2是一个进化尺度的蛋白质序列模型，已在全部自然蛋白质序列上进行了训练（28）。训练数据集排除了人工序列，以及与评估中使用的新蛋白质测试集相似的任何序列（附录A.1）。ESM2使用掩蔽语言建模目标（29）进行训练，以从序列中的上下文中恢复氨基酸的身份（图1B）。这种训练目标已被证明能够在模型的内部表示中实现关于蛋白质折叠结构的信息（7-9, 30）。由于语言模型的训练仅基于序列，因此出现的结构信息必须是对序列中模式的无监督学习的结果。 

从语言模型的注意力图中的线性投影识别出反映蛋白质结构的内部状态。之前的工作已经表明，如ESM2这样的变压器蛋白质语言模型中的特定注意力图编码了结构中残基对的接近性（9, 30）。我们进行了一个线性投影拟合，它接受蛋白质序列中两个位置之间的注意力，并输出成对距离的分布（图1C）。这将内部注意状态的660个维度映射到18个残基间距离箱中。由于参数数量有限（每个距离箱660个，总共11,898个，包括每个距离箱的偏置），远远不足以表示可能的蛋白质结构的巨大复杂性，输出可以解释为模型内部状态捕获的结构的投影。投影定义了一个能量景观（一个基于语言模型的表示状态的函数，而不是物理能量），可以用来评估任何给定结构与由语言模型产生的序列的表示的兼容性。应用于新蛋白质目标集显示了对现有新蛋白质的理解（表S1和图S2及S3）。  

综合来看，序列模型和给定序列的结构模型定义了一个由语言模型定义的蛋白质的生成模型。序列模型为任何序列分配一个概率，通过给出蛋白质中每个位置的每个氨基酸的概率（图1D）。对于自然蛋白质，这些概率反映了突变的功能效果、氨基酸的结构偏好以及生化功能的方面（31）。结构投影给出了语言模型的序列表示与三维结构之间的兼容性（图1E）。在这项工作中，我们考虑这些模型来指定一个蛋白质设计的生成模型：
p(sequence; structure) = p(structure|sequence)p(sequence)   
对于固定主链设计，蛋白质序列是通过从由语言模型指定的条件分布中进行低温采样生成的，采用马尔可夫链蒙特卡罗（MCMC）与模拟退火（图1F，附录A.3.1）。自由生成完全去除了对结构的限制，并通过从语言模型指定的序列和结构的联合分布中采样来生成新蛋白质。引入了一种阻塞的吉布斯采样方法，该方法在根据当前序列采样新结构和根据当前结构采样新序列之间交替进行（图1G，附录A.3.3）。图1H显示了一个自由生成轨迹的示例。随着温度的降低，轨迹从一个阶段开始，在这个阶段它采样了一系列可能的拓扑，然后缩小到一个单一的拓扑，该拓扑在优化的最后阶段被细化为一个自信预测的结构。  

我们对来自语言模型的总共228个设计进行了广泛的实验测试。被认为是成功的设计是那些表达良好、可溶并通过分子（流体动力学）半径的大小排阻色谱法（SEC）测试的（附录A.7）。大量生成的蛋白质的实验成功，以及对结构的独立计算评估，证明了语言模型能够访问超出自然蛋白质的设计空间。  


